@model dynamic
@{
    ViewBag.Title = "SmartPhone Requisition";
    var user = (Skoda_DCMS.Models.UserData)HttpContext.Current.Session["UserData"];
    bool IsNew = true;
    bool IsEdit = true;
    dynamic FlagRedirect = null;
    dynamic SPRF = null;
    Layout = ViewBag.Layout;
    int RowId = 0, FormId = 0, AppRowId = 0, ApprovalType = 0;
    int FormSrId = 0;
    if (ViewBag != null && ViewBag.IsNew != null)
    {
        IsNew = ViewBag.IsNew;
        IsEdit = ViewBag.IsEdit;
        SPRF = ViewBag.Model;
        RowId = ViewBag.RowId;
        FormId = ViewBag.FormId;
        AppRowId = ViewBag.AppRowId;
        ApprovalType = ViewBag.ApprovalType != null ? (int)ViewBag.ApprovalType : 0;
        FormSrId = SPRF.one[0].Id;
    }
}
<style type="text/css">
    .astColor {
        color: red;
    }

    .table-middle tr td, .table-middle tr th {
        text-align: center !important;
    }
    .checkmark {
        border: 1px solid black;
        position: absolute;
        top: 0;
        left: 0;
        height: 25px;
        width: 25px;
        background-color: #eee;
    }
    #OtherEmpName #txtOtherEmpname {
       @* max-width: 96%;*@
        border-radius: 0;
        height: 20%;
        font-size: 14px;
    }
    .bg-color td, .bg-color th {
        border: 1px solid #dee2e6;
        background-color: rgb(219,238,213) !important;
    }
    .bg-color-2 td {
        background-color: rgba(75,168,46,0.4) !important;
        border: 1px solid rgba(75,168,46,0.1) !important;
    }

    .bg-color-2 th {
        background-color: rgba(75,168,46,0.4) !important;
        border: 1px solid rgba(75,168,46,0.1) !important;
    }

    .bg-color-3 td {
        background-color: rgba(75,168,46,0.2) !important;
        border: 1px solid rgba(75,168,46,0.1) !important;
        border-bottom: 1px solid rgba(75,168,46,0.1) !important;
    }
    #loader {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        background: rgba(0,0,0,0.75) url(../../assets/img/Loading.gif) no-repeat center center;
        z-index: 10000;
    }
    .ui-front {
        z-index: 9999999 !important;
    }
</style>
<div class="right_col bg-transparent" role="main">

    <div class="container">
        <form action="/List/CreateSmartPhoneRequisitionRequest" id="SPRForm" method="post">
            @if (IsNew)
            {
                if (!IsEdit)
                {
                    <div>
                        <input type="hidden" id="FormSrId" name="FormSrId" value="@(SPRF.one[0].Id)" />
                        <input type="hidden" id="FormId" name="FormId" value="@(FormId)" />
                        <input type="hidden" id="AppRowId" name="AppRowId" value="@(AppRowId)" />
                    </div>
                }
                else
                {
                    <div class="breadcrumb-container">
                        <div>
                            <ol class="breadcrumb pl-0">
                                <li>
                                    <a href="/Dashboard?formName=SPRF">
                                        Dashboard
                                    </a>
                                </li>
                                <li class="active">
                                    <a href="/Dashboard/GetDepartmentWiseForms?department=HR">
                                        HR Department
                                    </a>
                                </li>
                                <li class="active">Smart Phone Requisition</li>
                            </ol>
                        </div>
                    </div>
                    <div class="form-main-container margin_space">
                        <div class="row topContent">
                            <div class="col-lg-9 col-md-7 padd_space">

                                <h5> Form Name : Smart Phone Requisition</h5>
                            </div>
                            <div class="col-lg-3 col-md-7 padd_space float-right text-right">

                                @*<h5> Form Department | Owner</h5>*@
                            </div>
                        </div>
                    </div>
                }}
            <div class="container form-container">
                <div class="card-header pb-4 pt-4">
                    <table class="w-100 m-auto">
                        <tr>
                            <td>
                                <table class="table mainTbl table-bordered form-table-container bg-color">
                                    <tbody>
                                        <tr>
                                            <td class="f-600 text-left pl-3">Classification</td>
                                            <td class="f-600 text-left pl-3">Internal</td>
                                            <td rowspan="2" class="text-right"><img class="img-fluid img-box" src="~/assets/img/skoda.png"></td>
                                        </tr>
                                        <tr>
                                            <td class="f-600 text-left pl-3">Version</td>
                                            <td class="f-600 text-left pl-3">01</td>
                                            <!-- <td rowspan="2"></td> -->
                                        </tr>
                                    </tbody>

                                </table>
                                <table class="table mainTbl table-bordered form-table-container bg-color">
                                    <tbody>
                                        <tr>
                                            <td colspan="6" class="heading form-heading">
                                                <span>Smart Phone Requisition Form</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class="table mainTbl table-bordered form-table-container-2 bg-color">
                                    <tbody>
                                        <tr>
                                            <td class="allFormLables borderLTB f-600">
                                                <label class="f-600">Date</label>
                                            </td>
                                            <td colspan="2" class="borderLTB text-left">
                                                <input type="text" name="txtDate" placeholder="/ /" class="w-100" value="@(!IsNew || !IsEdit ? (Convert.ToDateTime(SPRF.one[0].FormID.CreatedDate).ToShortDateString()) : DateTime.Now.ToShortDateString())" readonly>
                                            </td>

                                            @if (!IsNew || !IsEdit)
                                            {
                                                <td class="allFormLables borderLTB align" colspan="2">

                                                    <label class="f-600">Form Id</label>

                                                </td>
                                                <td colspan="2" class="borderLTB text-right">
                                                    <input type="text" name="txtFormId" class="w-100" value="@(!IsNew || !IsEdit ? ("SPRF" + SPRF.one[0].FormID.Id ?? "") : "" )" readonly>

                                                </td>
                                            }
                                        </tr>
                                        @if (!IsEdit)
                                        {
                                            foreach (var item in SPRF.one)
                                            {
                                                <tr>

                                                    <td class="w-20 allFormLables borderLTB f-600">
                                                        <label class="f-600">Request Submission For<span class="astColor">*</span></label>
                                                    </td>
                                                    <td colspan="2" class="borderLTB">
                                                        <select name="drpRequestSubmissionFor" id="drpRequestSubmissionFor" class="choice" onchange="RequestSubmissionFor()">
                                                            <option value="null">Choose</option>
                                                            <option value="Self" @(item.RequestSubmissionFor == "Self" ? "selected" : "")>Self</option>
                                                            <option value="OnBehalf" @(item.RequestSubmissionFor == "OnBehalf" ? "selected" : "")>On Behalf</option>
                                                        </select>
                                                    </td>
                                                    <td colspan="2" class="allFormLables borderLTB f-600 align">
                                                        <label class="f-600"></label>
                                                    </td>
                                                    <td class="borderLTB text-left" colspan="2">
                                                    </td>
                                                </tr>
                                            }
                                            <tr id="OtherEmpName" style="display: none;">
                                                <td>
                                                    <label id="lblOtherEmpName" class="control-label f-600">Name (Type at least 4 letters for faster results)</label>
                                                </td>
                                                <td><input type="text" name="txtOtherEmpname" id="txtOtherEmpname" class="form-control ui-autocomplete-input" required="required" autocomplete="off"></td>

                                            </tr>
                                        }
                                        else if (IsNew)
                                        {
                                            <tr>
                                                <td class="w-20 allFormLables borderLTB f-600">
                                                    <label class="f-600">Request Submission For<span class="astColor">*</span></label>
                                                </td>
                                                <td colspan="2" class="borderLTB">
                                                    <select name="drpRequestSubmissionFor" id="drpRequestSubmissionFor" class="choice" onchange="RequestSubmissionFor()">
                                                        <option value="null">Choose..</option>
                                                        <option value="Self">Self</option>
                                                        <option value="OnBehalf">On Behalf</option>
                                                    </select>
                                                </td>
                                                <td colspan="2" class="allFormLables borderLTB f-600 align">
                                                    <label class="f-600"></label>
                                                </td>
                                                <td class="borderLTB text-left" colspan="2">
                                                </td>

                                            </tr>
                                            <tr id="OtherEmpName" style="display: none;">
                                                <td>
                                                    <label id="lblOtherEmpName" class="control-label f-600">Name (Type at least 4 letters for faster results)</label>
                                                </td>
                                                <td><input type="text" name="txtOtherEmpname" id="txtOtherEmpname" class="form-control ui-autocomplete-input" required="required" autocomplete="off"></td>
                                            </tr>
                                        }
                                        <tr>
                                            <td class="w-20 allFormLables borderLTB f-600">
                                                <label class="f-600">Type of Employee<span class="astColor">*</span></label>
                                            </td>
                                            <td colspan="2" class="borderLTB">
                                                <label class="checkbox-container">
                                                    Internal Only
                                                    @if ((!IsNew) && (SPRF.one[0].EmployeeType == "Internal"))
                                                    {
                                                        <input type="checkbox" class="inpDisable" name="chkInternal" id="chkInternal" checked>
                                                    }
                                                    else
                                                    {
                                                        <input type="checkbox" name="chkInternal" id="chkInternal" value="Internal" checked>
                                                    }
                                                    <span class="checkmark"></span>
                                                </label>
                                            </td>
                                            <td colspan="2" class="allFormLables borderLTB f-600 align">
                                            </td>
                                            <td class="borderLTB text-left" colspan="2">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="allFormLables borderLTB">
                                                <label class="f-600">Employee Code<span class="astColor">*</span></label>
                                            </td>
                                            <td colspan="2" class="borderLTB">
                                                <input type="text" class="w-100 txtDisable" id="txtEmployeeCode" name="txtEmployeeCode" value="@(!IsNew || !IsEdit ? (SPRF.one[0].EmployeeCode ?? "") : "")" onkeypress="allowNumbersOnly(event)" />
                                            </td>
                                            <td colspan="2" class="allFormLables borderLTB align">
                                                <label class="f-600">Cost Center No<span class="astColor">*</span></label>
                                            </td>
                                            <td class="borderLTB text-right" colspan="2">
                                                <input type="text" class="w-100 txtDisable" name="txtCostcenterCode" id="txtCostcenterCode" value="@(!IsNew ||!IsEdit ? (SPRF.one[0].EmployeeCCCode ?? "") : "")" onkeypress="allowNumbersOnly(event)" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="allFormLables borderLTB">
                                                <label class="f-600">Employee Name<span class="astColor">*</span></label>
                                            </td>
                                            <td colspan="2" class="borderLTB">
                                                <input type="text" class="w-100 txtDisable" name="txtEmployeeName" id="txtEmployeeName" value="@(!IsNew ||!IsEdit ? (SPRF.one[0].EmployeeName ?? "") : "")" onkeypress="alphaOnly(event)" />
                                            </td>
                                            <td colspan="2" class="allFormLables borderLTB align">
                                                <label class="f-600">User ID<span class="astColor">*</span></label>
                                            </td>
                                            <td class="borderLTB text-right" colspan="2">
                                                <input type="text" class="w-100 txtDisable" name="txtUserId" id="txtUserId" value="@(!IsNew ||!IsEdit ? (SPRF.one[0].EmployeeUserId ?? "") : "")" onkeypress="allowNumbersOnly(event)" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="allFormLables borderLTB f-600">
                                                <label class="f-600">Department<span class="astColor">*</span></label>
                                            </td>
                                            <td colspan="2" class="borderLTB">
                                                <input type="text" class="w-100 txtDisable" name="txtDepartment" id="txtDepartment" value="@(!IsNew ||!IsEdit ? (SPRF.one[0].EmployeeDept ?? "") : "")" onkeypress="alphaOnly(event)" />
                                            </td>
                                            <td colspan="2" class="allFormLables borderLTB align">
                                                <label class="f-600">Contact No</label>
                                            </td>
                                            <td class="borderLTB text-right" colspan="2">
                                                <input type="text" class="w-100 txtDisable" name="txtContactNo" id="txtContactNo" value="@(!IsNew ||!IsEdit ? (SPRF.one[0].EmployeeContactNo ?? "") : "")" onkeypress="allowNumbersOnly(event)" />
                                            </td>
                                        </tr>
                                        <tr>
                                            @if (IsNew)
                                            {
                                                if (!IsEdit)
                                                {


                                                    <td class="allFormLables borderLTB f-600">
                                                        <label class="f-600">Designation<span class="astColor">*</span></label>
                                                    </td>
                                                    <td colspan="2" class="borderLTB">
                                                        <select name="ddEmpDesignation" class="drpSize" id="ddEmpDesignation"></select>
                                                    </td>
                                                    <td colspan="2" class="allFormLables borderLTB align">
                                                        <label class="f-600">Location<span class="astColor">*</span></label>
                                                    </td>
                                                    <td class="borderLTB text-right" colspan="2">
                                                        <select name="ddEmpLocation" class="drpSize" id="ddEmpLocation"></select>
                                                    </td>
                                                }
                                                else
                                                {
                                                    <td class="allFormLables borderLTB f-600">
                                                        <label class="f-600">Designation<span class="astColor">*</span></label>
                                                    </td>
                                                    <td colspan="2" class="borderLTB">
                                                        <select name="ddEmpDesignation" class="drpSize" id="ddEmpDesignation" onchange="getDisplayApproverSection()"></select>
                                                    </td>
                                                    <td colspan="2" class="allFormLables borderLTB align">
                                                        <label class="f-600">Location<span class="astColor">*</span></label>
                                                    </td>
                                                    <td class="borderLTB text-right" colspan="2">
                                                        <select name="ddEmpLocation" class="drpSize" id="ddEmpLocation"></select>
                                                    </td>
                                                }
                                            }
                                            else
                                            {
                                                <td class="allFormLables borderLTB f-600">
                                                    <label class="f-600">Designation<span class="astColor">*</span></label>
                                                </td>
                                                <td colspan="2" class="borderLTB">
                                                    <input type="text" class="w-100 txtDisable" name="txtdesignation" id="txtdesignation" value="@(!IsNew ? (SPRF.one[0].EmployeeDesignation ?? "") : "")" />
                                                </td>
                                                <td colspan="2" class="allFormLables borderLTB align">
                                                    <label class="f-600">Location<span class="astColor">*</span></label>
                                                </td>
                                                <td class="borderLTB text-right" colspan="2">
                                                    <input type="text" class="w-100 txtDisable" name="txtLocation" id="txtLocation" value="@(!IsNew ? (SPRF.one[0].EmployeeLocation ?? "") : "")" />
                                                </td>
                                            }
                                        </tr>
                                        <tr>
                                            <td colspan="6" class="allFormLables borderLTB f-600">
                                                Details:
                                            </td>

                                        </tr>
                                        <tr>
                                            <td colspan="6" class="allFormLables borderLTB f-600">
                                                <label class="photography-para">1. The monthly fee for the use of the Mobile Device Management Service is 49,50€/User</label>

                                            </td>

                                        </tr>
                                        <tr>
                                            <td colspan="6" class="allFormLables borderLTB f-600">
                                                <label class="photography-para">2. International Roaming services will be activated as per the Mobile Phone Policy</label>

                                            </td>

                                        </tr>
                                        <tr>
                                            <td colspan="6" class="allFormLables borderLTB f-600">
                                                <span>Reason for Requisition (Business Need - Please provide detailed reason) (Max. 500)<span class="astColor">*</span></span>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="6" class="allFormLables borderLTB f-600">
                                                <textarea class="textTrans txtDisable" cols="60" rows="3" name="txtBusinessNeed" id="txtBusinessNeed" maxlength="1000">@(!IsNew || !IsEdit ? (SPRF.one[0].BusinessNeed ?? ""):"")</textarea>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                        <table class="table mainTbl table-bordered form-table-container-2 bg-color">
                                            <tbody>
                                                <tr>
                                                    <td colspan="6" class="allFormLables borderLTB f-600">
                                                        Compliance with the privacy terms:
                                                    </td>

                                                </tr>
                                                <tr>
                                                    <td colspan="6" class="allFormLables borderLTB f-600">
                                                        While using company issued smartphone and the respective services, attention is to be paid to the privacy and security terms of the Volkswagen AG.
                                                    </td>
                                                </tr>
                                                <table class="table mainTbl table table-bordered table-sm dataTable no-footer border-none bg-color-2 table-middle" id="smartphoneApproverSection" style="display:none;">
                                                    <tbody>
                                                        <tr>
                                                            <th rowspan="2">Requester Signature</th>
                                                            <th rowspan="2">
                                                                Head of Section

                                                            </th>
                                                            <th rowspan="2">
                                                                Executive Director / Vice
                                                                <br />
                                                                President of requester Signature
                                                            </th>
                                                            <th colspan="2" scope="colgroup">
                                                                In case of Deviation in Mobile Phone Policy
                                                            </th>
                                                        </tr>
                                                        <tr>
                                                            <th>Managing Director Signature</th>
                                                            <th>CIO</th>
                                                        </tr>
                                                        @if (IsNew)
                                                        {
                                                            <tr class="f-600">
                                                                <td></td>
                                                                <td></td>
                                                                <td> </td>
                                                                <td></td>
                                                                <td></td>
                                                            </tr>
                                                        }

                                                        @if (!IsNew || !IsEdit)
                                                        {
                                                            if (SPRF.four == 1)
                                                            {
                                                                if ((SPRF.two.Count > 0) || (SPRF.three.Count > 0))
                                                                {
                                                                    //Approver Names
                                                                    <tr class="f-600">
                                                                        <td>@((!IsNew || !IsEdit) ? (SPRF.two[0].Author.Title ?? " ") : user.UserName)</td>
                                                                        <td>
                                                                            @((!IsNew || !IsEdit) ? (SPRF.three[0].UserName ?? "") : "Signature")
                                                                        </td>
                                                                        <td>
                                                                            @((!IsNew || !IsEdit) ? (SPRF.three[1].UserName ?? "") : "Signature")
                                                                        </td>
                                                                        <td>
                                                                            @((!IsNew || !IsEdit) ? (SPRF.three[2].UserName ?? "") : "Signature")
                                                                        </td>
                                                                        <td>@((!IsNew || !IsEdit) ? (SPRF.three[3].UserName ?? "") : "Signature")</td>
                                                                    </tr>
                                                                    //Approval Status
                                                                    <tr class="f-600">
                                                                        <td class="date-row-info">
                                                                            <span>
                                                                                <span class="year-info">
                                                                                    <label name="lblInitDate">
                                                                                        @((!IsNew || !IsEdit) ? " Submitted on " + Convert.ToDateTime(SPRF.two[0].FormId.Created).ToShortDateString() + " " + Convert.ToDateTime(SPRF.two[0].FormId.Created).ToShortTimeString() ?? "" : "")
                                                                                    </label>
                                                                                </span>
                                                                            </span>
                                                                        </td>
                                                                        <td class="date-row-info">
                                                                            <span>

                                                                                @(((!IsNew || !IsEdit) && SPRF.three[0].ApproverStatus != "Pending") ? (SPRF.three[0].ApproverStatus + " on " +" "+Convert.ToDateTime(SPRF.three[0].Modified).ToShortDateString() + " " + Convert.ToDateTime(SPRF.three[0].Modified).AddHours(5.5).ToShortTimeString()) : "" )

                                                                            </span>
                                                                        </td>
                                                                        <td>
                                                                            <span>
                                                                                <label name="txtExeD">
                                                                                    @((!IsNew || !IsEdit) && SPRF.three[1].ApproverStatus != "Pending" ? (SPRF.three[1].ApproverStatus + " on " + " " + Convert.ToDateTime(SPRF.three[1].Modified).ToShortDateString() + " " + Convert.ToDateTime(SPRF.three[1].Modified).AddHours(5.5).ToShortTimeString()) : "" )
                                                                                </label>
                                                                            </span>
                                                                        </td>
                                                                        <td>
                                                                            <span>
                                                                                <label name="txtMD">
                                                                                    @((!IsNew || !IsEdit) && SPRF.three[2].ApproverStatus != "Pending" ? (SPRF.three[2].ApproverStatus + " on " + " " + Convert.ToDateTime(SPRF.three[2].Modified).ToShortDateString() + " " + Convert.ToDateTime(SPRF.three[2].Modified).AddHours(5.5).ToShortTimeString()) : "" )
                                                                                </label>
                                                                            </span>
                                                                        </td>
                                                                        <td>
                                                                            <span>
                                                                                <label name="txtCIO">
                                                                                    @((!IsNew || !IsEdit) && SPRF.three[3].ApproverStatus != "Pending" ? (SPRF.three[3].ApproverStatus + " on " + " " + Convert.ToDateTime(SPRF.three[3].Modified).ToShortDateString() + " " + Convert.ToDateTime(SPRF.three[3].Modified).AddHours(5.5).ToShortTimeString()) : "" )

                                                                                </label>
                                                                            </span>
                                                                        </td>
                                                                    </tr>
                                                                    //Approver Comments
                                                                    if (SPRF.three[0].ApproverStatus != "Pending")
                                                                    {
                                                                        <tr>
                                                                            <td class="date-row-info">
                                                                                <span>
                                                                                    <label name="txtRequestor">
                                                                                    </label>
                                                                                </span>
                                                                            </td>
                                                                            <td class="date-row-info">
                                                                                <span>
                                                                                    @if (SPRF.three[0].ApproverStatus != "Pending")
                                                                                    {
                                                                                        <label name="txtHod">
                                                                                            <textarea class="textTrans" cols="30" rows="3" readonly>@((!IsNew || !IsEdit) ? (SPRF.three[0].Comment ?? "") : "")</textarea>
                                                                                        </label>
                                                                                    }
                                                                                </span>
                                                                            </td>
                                                                            <td>
                                                                                <span>
                                                                                    @if (SPRF.three[1].ApproverStatus != "Pending")
                                                                                    {
                                                                                        <label name="txtExeD">
                                                                                            <textarea class="textTrans" cols="30" rows="3" readonly>@((!IsNew || !IsEdit) ? (SPRF.three[1].Comment ?? "") : "")</textarea>

                                                                                        </label>
                                                                                    }
                                                                                </span>
                                                                            <td>
                                                                                <span>
                                                                                    @if (SPRF.three[2].ApproverStatus != "Pending")
                                                                                    {
                                                                                        <label name="txtMD">
                                                                                            <textarea class="textTrans" cols="30" rows="3" readonly>@((!IsNew || !IsEdit) ? (SPRF.three[2].Comment ?? "") : "")</textarea>

                                                                                        </label>
                                                                                    }
                                                                                </span>
                                                                            </td>
                                                                            <td>
                                                                                <span>
                                                                                    @if (SPRF.three[3].ApproverStatus != "Pending")
                                                                                    {
                                                                                        <label name="txtCIO">
                                                                                            <textarea class="textTrans" cols="30" rows="3" readonly>@((!IsNew || !IsEdit) ? (SPRF.three[3].Comment ?? "") : "")</textarea>
                                                                                        </label>
                                                                                    }
                                                                                </span>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    </tbody>
                                                </table>
                                            </tbody>
                                        </table>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div>
                <p class="text-left f-600">SF_FI_031</p>
            </div>
            @if (IsNew)
            {
                if (!IsEdit)
                {
                    <div class="card-footer align-content-center">
                        <button type="button" class="btn btn-primary btn-sm submit-btn" id="btnSubmit">
                            Re-Submit
                        </button>
                        <button type="reset" class="btn btn-danger btn-sm cancl-btn">
                            Cancel
                        </button>
                    </div>
                }
                else
                {
                    <div class="card-footer align-content-center">
                        <button type="button" class="btn btn-primary btn-sm submit-btn" id="btnSubmit">
                            Submit
                        </button>
                        <button type="reset" class="btn btn-danger btn-sm cancl-btn">
                            Cancel
                        </button>
                    </div>
                }
            }
        </form>
    </div>
</div>
<div class="modal fade" id="successModel" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header modelHeader">
                <span class="modal-title modalMsgTitle" id="modalTitle"></span>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <label id="modalBody" class="lableMsg">  </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="submitBomBtn publishBtn" id="modalOkButton">OK</button>
            </div>
        </div>
    </div>
</div>
<script>
    var spinner = $('#loader');
    var isNew = @Html.Raw(Json.Encode(IsNew));
    var sprf = @Html.Raw(Json.Encode(SPRF));
    var appRowId = @Html.Raw(Json.Encode(AppRowId));
    var approvalType =@Html.Raw(Json.Encode(ApprovalType));
    var isEdit = @Html.Raw(Json.Encode(IsEdit));
    var FlagRedirect = @Html.Raw(Json.Encode(FlagRedirect));
    var formID = @Html.Raw(Json.Encode(FormId));
    var RowId = @Html.Raw(Json.Encode(RowId));
    pageLoad();
    //console.log(sprf);

    function pageLoad() {
        spinner.hide();
       // getExtEmpDetails();
        if (isNew) {
            getDesignations();
            getServiceDeskLocations();

            $("#OtherEmpName").hide();
           // getCurrentDateTime();
        }
        if (!isNew) {
            $(".inpDisable").attr("disabled", "disabled");
            $(".txtDisable").prop("readonly", true);

            var value = JSON.stringify(sprf[3]);
            var value_1 = JSON.parse(value);

            if (value_1.Value == 1) {
                $('#smartphoneApproverSection').show();
            }
        }

        if (!isEdit) {
            getDesignations();
            getServiceDeskLocations();

            var value = JSON.stringify(sprf[3]);
            var value_1 = JSON.parse(value);

            if (value_1.Value == 1) {
                $('#smartphoneApproverSection').show();
            }
        }
    }


    function successModal() {
        //debugger
        $('#modalTitle').html('Success');
        $('#modalBody').html('Your form has been submitted!');
        $("#modalOkButton").attr('data-dismiss', 'modal');
        $("#successModel").modal('show');
    }

    function internalOnlyModal() {
        //debugger
        $('#modalTitle').html('Required');
        $('#modalBody').html('This form is only for internal employee!');
        $("#modalOkButton").attr('data-dismiss', 'modal');
        $("#successModel").modal('show');
    }

    function successModal(txt) {
        //debugger
        $('#modalTitle').html('Success');
        if (txt == "approve") {
            $('#modalBody').html('Form has been approved!');
            FlagRedirect = txt;
        }
        else if (txt == "reject") {
            $('#modalBody').html('Form has been rejected!');
        }
        else if (txt == "enquire") {
            $('#modalBody').html('Form has been enquired!');
        }
        else if (txt == "cancelled") {
            $('#modalBody').html('Form has been cancelled!');
        }

         else {
            $('#modalBody').html('Your form with ID: SPRF' + txt + ' has been submitted! Kindly use this for future reference');
            FlagRedirect = txt;
        }
        $("#modalOkButton").attr('data-dismiss', 'modal');
        $("#successModel").modal('show');
    }


    function failureModal() {
        $('#modalTitle').html('Failure');
        $('#modalBody').html('Some error occured!');
        $("#modalOkButton").attr('data-dismiss', 'modal');
        $("#successModel").modal('show');
    }

    function requiredModal(text) {
        $('#modalTitle').html('Required');
        $('#modalBody').html(text + '!');
        $("#modalOkButton").attr('data-dismiss', 'modal');
        $("#successModel").modal('show');
    }

    $("#btnSubmit").on('click', function (e) {
        e.preventDefault();

        var employeeCodelen = $("#txtEmployeeCode").val().length;
        if (employeeCodelen == 0 || employeeCodelen < 0) {
            requiredModal('Please enter a valid Employee Code');
            return false;
        }

        var costCenterNumlen = $("#txtCostcenterCode").val().length;
        if (costCenterNumlen < 6) {
            requiredModal('Please enter a valid Cost Center Code');
            return false;
        }

        var userIdlen = $("#txtUserId").val().length;
        if (userIdlen == 0 || userIdlen < 0) {
            requiredModal('Please enter a valid User Id');
            return false;
        }
        var name = document.getElementById("txtEmployeeName").value;
        if (name == "") {
            requiredModal("Please enter the Name of Employee");
            return false;
        }
        var department = document.getElementById("txtDepartment").value;
        if (department == "") {
            requiredModal("Please enter the Department");
            return false;
        }
        
        var designation = document.getElementById("ddEmpDesignation").selectedIndex;
        if (designation == 0) {
            requiredModal("Please select Designation");
            return false;
        }

        var location = document.getElementById("ddEmpLocation").selectedIndex;
        if (location == 0) {
            requiredModal("Please select Location");
            return false;
        }
       
        var businessNeed = document.getElementById("txtBusinessNeed").value;
        if (businessNeed == "") {
            requiredModal("Please enter the Business Need");
            return false;
        }

        $("#pageLoader").removeClass('invisible');
        var form = $("#SPRForm").serialize();
        $.ajax({
            url: '/SmartPhone/CreateSmartPhoneRequisitionRequest',
            type: 'POST',
            data: form,
            cache: false,
            dataType: 'JSON',
            success: (function (data) {
                if (data[0].Value == 1) {
                    $("#pageLoader").addClass('invisible');
                    successModal(data[1].Value);
                    $("#SPRForm").trigger("reset");
                }
                else {
                    failureModal();
                    $("#SPRForm").trigger("reset");
                }
            }),
            error: (function (data) {
                failureModal();
                $("#pageLoader").addClass('invisible');
                $("#SPRForm").trigger("reset");
            })
        })
    });

    function getDesignations() {
        if (isNew)
        {
            if (!isEdit)
            {
                var value = JSON.stringify(sprf[0]);
                console.log(value)
                var value_1 = JSON.parse(value);
                var selectedDesignation = value_1.Value[0].EmployeeDesignation;
                console.log(selectedDesignation);

                $.ajax({
                    type: "POST",
                    url: "/List/GetDesignations",
                    contentType: "application/json; charset=utf-8",
                    datatype: 'json',
                    cache: false,
                    async: false,
                    success: function (data) {
                        console.log(data);
                        var s = '<option value="">Select</option>';

                        for (var i = 0; i < data.length; i++) {
                            if (data[i].JobTitle == selectedDesignation) {
                                console.log("hiiii" + data[i].JobTitle);
                                s += '<option value="' + data[i].JobTitle + '" selected>' + data[i].JobTitle + '</option>';
                            }
                            else {
                                s += '<option value="' + data[i].JobTitle + '">' + data[i].JobTitle + '</option>';
                            }
                        }
                        $("#ddEmpDesignation").html(s);


                    },          ////success
                    error: function () {
                        //alert('Failed to retrieve modules.');
                    }
                });
            }
            else {

                $.ajax({
                    type: "POST",
                    url: "/List/GetDesignations",
                    contentType: "application/json; charset=utf-8",
                    datatype: 'json',
                    cache: false,
                    async: false,
                    success: function (data) {
                        console.log(data);
                        var s = '<option value="">Select</option>';

                        for (var i = 0; i < data.length; i++) {
                            s += '<option value="' + data[i].JobTitle + '">' + data[i].JobTitle + '</option>';
                        }
                        $("#ddEmpDesignation").html(s);
                    },
                    error: function (data) {
                        //code
                    }
                });

            }
        }
    }



    function getServiceDeskLocations() {
        if (isNew) {
            if (!isEdit) {
                var value = JSON.stringify(sprf[0]);
                console.log(value)
                var value_1 = JSON.parse(value);
                var selectedLocation = value_1.Value[0].EmployeeLocation;
                console.log(selectedLocation);

                $.ajax({
                    type: "GET",
                    url: "/List/GetServiceDeskLocations",
                    contentType: "application/json; charset=utf-8",
                    datatype: 'json',
                    cache: false,
                    async: false,
                    success: function (data) {
                        console.log(data);
                        var s = '<option value="">Select</option>';

                        for (var i = 0; i < data.length; i++) {
                            if (data[i].LocationName == selectedLocation) {
                                s += '<option value="' + data[i].LocationName + '" selected>' + data[i].LocationName + '</option>';
                            }
                            else if ((data[i].LocationName == "Pune File Server") || (data[i].LocationName == "Mumbai File Server") || (data[i].LocationName == "Aurangabad File Server") || (data[i].LocationName == "External")) { }
                            else {
                                        s += '<option value="' + data[i].LocationName + '">' + data[i].LocationName + '</option>';
                            }

                        }
                        $("#ddEmpLocation").html(s);

                    },
                    error: function () {

                    }
                });
            }
            else {
                $.ajax({
                    type: "GET",
                    url: "/List/GetServiceDeskLocations",
                    contentType: "application/json; charset=utf-8",
                    datatype: 'json',
                    cache: false,
                    async: false,
                    success: function (data) {
                        console.log("Hi=" + data);
                        var s = '<option value="">Select</option>';

                        for (var i = 0; i < data.length; i++) {
                            if (!((data[i].LocationName == "Pune File Server") || (data[i].LocationName == "Mumbai File Server") || (data[i].LocationName == "Aurangabad File Server") || (data[i].LocationName == "External"))) {
                                s += '<option value="' + data[i].LocationName + '">' + data[i].LocationName + '</option>';
                            }
                        }

                        $("#ddEmpLocation").html(s);
                    },
                    error: function () {

                    }
                });
            }
        }
    }


    function saveResponse(text) {
        var status = '', comment = '';
        comment = $("#comment-" + text).val();
        switch (text) {
            case 'approve': {
                status = 'Approved';
                break;
            }
            case 'reject': {
                status = 'Rejected';
                if (comment == '') {
                    //validityModal(text);
                    return;
                }
                break;
            }
            case 'enquire': {
                status = 'Enquired';
                if (comment == '') {
                    //validityModal(text);
                    return;
                }
                break;
            }
        }
        $.ajax({
            url: '/List/SaveResponse',
            type: 'POST',
            data: { response: status, appRowId: appRowId, comment: comment, approvalType: approvalType },
            dataType: 'JSON',
            success: (function (data) {
                if (data == 1) {
                    successModal(text);
                    $("#SPRForm").trigger("reset");
                    setTimeout(FilterMyTasks, 5000)
                }
                else {
                    failureModal();
                    $("#SPRForm").trigger("reset");
                }

            }),
            error: (function (data) {
                failureModal();
                $("#SPRForm").trigger("reset");
            })
        })

        return false;
    }

    $("#txtOtherEmpname").autocomplete({
        source: function (request, response) {
            $.ajax({
                url: "/List/GetEmployeeDetails",
                dataType: "json",
                cache: false,
                async: false,
                data: {
                    searchText: $("#txtOtherEmpname").val()
                },
                success: function (data) {
                    //debugger;
                    response($.map(data, function (item) {
                        console.log(data, 'data');
                        return { label: item.FirstName, value: item.FirstName, raw: item };
                    }));
                }
            });
        },
        search: function (event, ui) {
            var value = $("#txtOtherEmpname").val();
            // If less than three chars, cancel the search event
            if (value.length < 4) {
                event.preventDefault();
            }
        },
        min_length: 5,
        delay: 0,
        select: function (event, ui) {
            //debugger;
            var empOtherDetails = ui.item['raw'];
            //Get the other details like Cost Center Code, Employee Number from DB.
            $.ajax({
                url: "/List/GetExistingEmployeeDetails",
                dataType: "json",
                cache: false,
                async: false,
                data: {
                    otherEmpUserId: empOtherDetails.Email,
                },
                success: function (data) {
                    console.log(data, 'data');
                    //$('#txtOtherEmpCCCode').val(data.CostCenter);
                    $('#txtEmployeeCode').val(data.EmpNumber);
                    $('#txtDepartment').val(data.Department);
                    $('#txtEmployeeName').val(data.UserName);
                    $('#txtCostcenterCode').val(data.CostCenter);
                    $('#txtUserId').val(data.UserId);

                }
            });
        }
    });


     function RequestSubmissionFor() {
       // debugger
         getServiceDeskLocations();
         var drpRequestSubmissionFor = $("#drpRequestSubmissionFor").val();
         if (drpRequestSubmissionFor == "OnBehalf") {
            $("#OtherEmpName").show();
            $("#txtOtherEmpname").val('');
            $("#txtEmployeeCode").val("");
            $("#txtCostcenterCode").val("");
            $("#txtUserId").val("");
            $("#txtEmployeeName").val("");
            $("#txtDepartment").val("");
            $("#txtContactNo").val("");
            $("#chkEmployeeType").val('Internal');
            $("#ddEmpDesignation").prop("selectedIndex", 0).val();
            $("#ddEmpLocation").prop("selectedIndex", 0).val();
        }
         else if (drpRequestSubmissionFor == "Self") {
            $("#OtherEmpName").hide();
            $("#txtEmployeeCode").val("@user.EmpNumber");
            $("#txtCostcenterCode").val("@user.CostCenter");
            $("#txtUserId").val("@user.UserId");
            $("#txtEmployeeName").val("@user.UserName");
            $("#txtDepartment").val("@user.Department");
            $("#txtContactNo").val("");
             $('input[id="chkInternal"]').prop("checked", true);

          
            $("#chkEmployeeType").val('Internal');
            $("#ExternalOrganizationName").hide();
            $("#ExternalOtherOrganizationName").hide();
            $("#ddEmpDesignation").prop("selectedIndex", 0).val();
            $("#ddEmpLocation").prop("selectedIndex", 0).val();
        }
        else {
            $("#OtherEmpName").hide();
            $("#txtEmployeeCode").val("");
            $("#txtCostcenterCode").val("");
            $("#txtUserId").val("");
            $("#txtEmployeeName").val("");
            $("#txtDepartment").val("");
            $("#txtContactNo").val("");
            $('input[id="chkInternal"]').prop("checked", false);
            $('input[id="chkInternal"]').prop("disabled", false);
            $("#ExternalOrganizationName").hide();
            $("#ExternalOtherOrganizationName").hide();
            $("#ddEmpDesignation").prop("selectedIndex", 0).val();
            $("#ddEmpLocation").prop("selectedIndex", 0).val();
             }
     }

    function allowNumbersOnly(e) {
        var code = (e.which) ? e.which : e.keyCode;
        if (code > 31 && (code < 48 || code > 57)) {
            e.preventDefault();
        }
    }
    function alphaOnly(e) {
        var key = e.keyCode;
        if (key > 32 && (key < 65 || key > 122 || key == 91 || key == 92 || key == 93 || key == 94 || key == 95 || key == 96)) {
            e.preventDefault();
        }
    }
   function redirectUser() {
    window.location = '/Dashboard/Index';
    }


    $("#modalOkButton").on('click', function () {
        //debugger

        if (FlagRedirect != null) {
            spinner.show();
            $.ajax({
                url: '/EmailService/FormStatus',
                type: 'POST',
                data: { dataRowId: RowId, formID: formID },
                dataType: 'JSON',
                success: (function (data) {
                    if (data.Result == 1) {
                        spinner.hide();
                        window.location = "../Dashboard";
                    }
                    else {
                        spinner.hide();
                        window.location = "../Dashboard";
                    }

                }),
                error: (function (data) {
                    spinner.hide();
                    window.location = "../Dashboard";
                })
            })
        }


    });

    $("#chkInternal").click(function () {
        if ($(this).prop("checked") == false)
        {
            internalOnlyModal();
            document.getElementById("chkInternal").checked = true;
        }
    });

    function getDisplayApproverSection() {
        var desg = document.getElementById("ddEmpDesignation").value;
        console.log(desg);
        if (desg == "Team Member" || desg == "Graduate Engineer Trainee" || desg == "Officer" || desg == "Senior Officer" || desg == "Assistant Manager" || desg == "Deputy Manager" || desg == "Manager" || desg == "Senior Manager" || desg == "Chief Manager") {
            $('#smartphoneApproverSection').show();
        }
        else {
            $('#smartphoneApproverSection').hide();
        }
    }

</script>



